#!/bin/sh

# Git Push 안전성 검증 파이프라인
# 1. 브랜치 패턴 검사
BRANCH_NAME=$(git symbolic-ref --short HEAD)
if ! echo "$BRANCH_NAME" | grep -Eq '^(main|release|dev|hotfix|feat\/[a-z0-9._-]+|fix\/[a-z0-9._-]+|refactor\/[a-z0-9._-]+|test\/[a-z0-9._-]+|docs\/[a-z0-9._-]+|chore\/[a-z0-9._-]+)$'; then
  echo "🚫 브랜치 이름 잘못 작성함!!"
  echo "이 중에 하나만 허용: main, release, dev, hotfix, <type>/<desc>"
  exit 1
fi

# 2. 코드 스타일 규칙 검증
echo "Push 전 엄격한 Lint 규칙 검증..."
yarn lint:strict || exit 1

# 3. 타입 안전성 검증
echo "Push 전 타입 안전성 검증..."
yarn typecheck || exit 1